<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#00a0e0">
    <meta name="description" content="MejÃ­a GIS - Visualizador HidroecolÃ³gico">
    <title>MejÃ­a GIS | Visualizador HidroecolÃ³gico</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ—ºï¸</text></svg>">
    <link rel='stylesheet' href='https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css'/>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <aside id="sidebar-left">
        <header>
            <h1>MEJÃA <span class="accent">GIS</span></h1>
            <p>Panel de Control Multicapa</p>
        </header>

        <div class="sidebar-tabs">
            <button class="sidebar-tab active" data-tab="layers">ğŸ“ Capas</button>
            <button class="sidebar-tab" data-tab="dashboards">ğŸ“Š Dashboards</button>
            <button class="sidebar-tab" data-tab="reportes">ğŸ”” Reportes</button>
        </div>

        <div id="layers-tab" class="sidebar-content active">
            <section id="basemap-selector" class="control-section">
                <h3>ğŸ—ºï¸ MAPA BASE</h3>
                <select id="basemap-dropdown" class="dropdown">
                    <option value="positron">Claro (Positron)</option>
                    <option value="dark">Oscuro (Dark Matter)</option>
                    <option value="osm">OpenStreetMap</option>
                    <option value="satellite">SatÃ©lite (Esri)</option>
                </select>
            </section>

            <section id="layer-manager">
                <div class="layer-group">
                    <button class="group-toggle" onclick="window.toggleGroup(this)"><span class="arrow">â–¶</span> Referencia Territorial</button>
                    <div class="group-content">
                        <button class="btn" onclick="window.ctrlLayer('4326_parroquias_mejia', this)">LÃ­mites Parroquiales</button>
                    </div>
                </div>

                <div class="layer-group">
                    <button class="group-toggle" onclick="window.toggleGroup(this)"><span class="arrow">â–¶</span> DinÃ¡mica e Impacto Humano</button>
                    <div class="group-content">
                        <button class="btn" onclick="window.ctrlLayer('4326_zonas_prioritarias_conservacion_mejia', this)">Zonas de ConservaciÃ³n</button>
                        <button class="btn" onclick="window.ctrlLayer('4326_uso_ocupacion_suelo_mejia', this)">Uso de Suelo</button>
                        <button class="btn" onclick="window.ctrlLayer('4326_presion_antropica_mejia', this)">PresiÃ³n AntrÃ³pica</button>
                    </div>
                </div>

                <div class="layer-group">
                    <button class="group-toggle" onclick="window.toggleGroup(this)"><span class="arrow">â–¶</span> CondiciÃ³n EcohidrolÃ³gica</button>
                    <div class="group-content">
                        <button class="btn" onclick="window.ctrlLayer('4326_riesgo_hidroecologico_mejia', this)">Riesgo HidroecolÃ³gico</button>
                        <button class="btn" onclick="window.ctrlLayer('4326_funcionalidad_uso_suelos_mejia', this)">Funcionalidad de Uso</button>
                        <button class="btn" onclick="window.ctrlLayer('4326_indice_funcionalidad_hidroecologico_mejia', this)">Ãndice IFH</button>
                        <button class="btn" onclick="window.ctrlLayer('4326_condicion_biofisica_mejia', this)">CondiciÃ³n BiofÃ­sica</button>
                        <button class="btn" onclick="window.ctrlLayer('4326_ndvi_mejia', this)">NDVI (VegetaciÃ³n)</button>
                        <button class="btn" onclick="window.ctrlLayer('4326_ndwi_mejia', this)">NDWI (Agua)</button>
                    </div>
                </div>

                <div class="layer-group">
                    <button class="group-toggle" onclick="window.toggleGroup(this)"><span class="arrow">â–¶</span> Soporte EdÃ¡fico-HidrolÃ³gico</button>
                    <div class="group-content">
                        <button class="btn" onclick="window.ctrlLayer('4326_unidades_suelo_mejia', this)">Unidades de Suelo</button>
                        <button class="btn" onclick="window.ctrlLayer('4326_retencion_hidirca_suelos_mejia', this)">RetenciÃ³n HÃ­drica</button>
                        <button class="btn" onclick="window.ctrlLayer('4326_indice_topografico_humedad_mejia', this)">Ãndice ITH</button>
                    </div>
                </div>

                <div class="layer-group">
                    <button class="group-toggle" onclick="window.toggleGroup(this)"><span class="arrow">â–¶</span> CondiciÃ³n FÃ­sico-GeomorfolÃ³gica</button>
                    <div class="group-content">
                        <button class="btn" onclick="window.ctrlLayer('4326_alturas_mejia', this)">AltimetrÃ­a</button>
                        <button class="btn" onclick="window.ctrlLayer('4326_pendientes_mejia', this)">Pendientes</button>
                    </div>
                </div>

                <div class="layer-group">
                    <button class="group-toggle" onclick="window.toggleGroup(this)"><span class="arrow">â–¶</span> Clima</button>
                    <div class="group-content">
                        <button class="btn" onclick="window.ctrlLayer('4326_temperatura_mejia', this)">Temperatura</button>
                        <button class="btn" onclick="window.ctrlLayer('4326_precipitacion_mejia', this)">PrecipitaciÃ³n</button>
                    </div>
                </div>
            </section>
        </div>

        <div id="dashboards-tab" class="sidebar-content">
            <section class="control-section">
                <h3>ğŸ“Š ANÃLISIS Y PLANIFICACIÃ“N</h3>
                <div class="dashboard-menu">
                    <button class="dashboard-btn" onclick="window.openDashboard('analisis-uso-suelo')"><span class="icon">ğŸŒ±</span><span>AnÃ¡lisis Uso de Suelo</span></button>
                    <button class="dashboard-btn" onclick="window.openDashboard('estado-ambiental')"><span class="icon">ğŸŒ¿</span><span>Estado Ambiental</span></button>
                    <button class="dashboard-btn" onclick="window.openDashboard('planificacion-territorial')"><span class="icon">ğŸ—ºï¸</span><span>PlanificaciÃ³n Territorial</span></button>
                    <button class="dashboard-btn" onclick="window.openDashboard('riesgo-ambiental')"><span class="icon">âš ï¸</span><span>Riesgo Ambiental</span></button>
                </div>
            </section>
        </div>

        <div id="reportes-tab" class="sidebar-content">
            <section class="control-section">
                <h3>ğŸ”” DENUNCIAS Y REPORTES</h3>
                <button class="btn-primary-full" onclick="window.openReporteForm()">+ Crear Nuevo Reporte</button>
                <div id="reportes-list" class="reportes-list"></div>
            </section>
        </div>
    </aside>

    <div id="map"></div>

    <div id="legend-container">
        <h4 id="legend-title">Sin capas activas</h4>
        <div id="legend-content"></div>
    </div>

    <aside id="sidebar-right">
        <button id="close-inspector" onclick="hideInspector()">âœ•</button>
        <div class="inspector-header">
            <div class="inspector-title-row"><h4>Atributos de la Capa</h4></div>
            <span id="layer-tag">INFO</span>
        </div>
        <div id="details">
            <p style="color: #94a3b8; text-align: center; padding: 40px 20px;">Haga clic en el mapa para visualizar los atributos de los elementos.</p>
        </div>
    </aside>

    <div id="dashboard-modal" class="modal">
        <div class="modal-content dashboard-container">
            <button class="close" onclick="window.closeDashboard()">&times;</button>
            <div id="dashboard-content"></div>
        </div>
    </div>

    <div id="reporte-modal" class="modal">
        <div class="modal-content reporte-form-container">
            <button class="close" onclick="window.closeReporteForm()">&times;</button>
            <div class="reporte-header-custom">
                <h2>Crear Denuncia/Reporte</h2>
                <p>AyÃºdanos a monitorear el estado ambiental del territorio</p>
            </div>
            <form id="reporte-form" class="reporte-form-custom">
                <div class="form-section">
                    <h3>ğŸ“ UbicaciÃ³n</h3>
                    <div class="form-group"><label>Latitud</label><input type="number" id="lat" step="0.0001" placeholder="-0.509" required></div>
                    <div class="form-group"><label>Longitud</label><input type="number" id="lng" step="0.0001" placeholder="-78.560" required></div>
                    <button type="button" class="btn-secondary" onclick="window.getGeolocalizacion()">ğŸ“ Usar Mi UbicaciÃ³n</button>
                </div>

                <div class="form-section">
                    <h3>ğŸ”” Tipo de Denuncia</h3>
                    <div class="form-group"><label>Selecciona la categorÃ­a</label>
                        <select id="tipo-denuncia" required>
                            <option value="">-- Seleccionar --</option>
                            <option value="contaminacion">ğŸŒ«ï¸ ContaminaciÃ³n del Agua</option>
                            <option value="deforestacion">ğŸŒ³ DeforestaciÃ³n</option>
                            <option value="erosion">ğŸœï¸ ErosiÃ³n del Suelo</option>
                            <option value="residuos">ğŸ—‘ï¸ Manejo Inadecuado de Residuos</option>
                            <option value="construccion">ğŸ—ï¸ ConstrucciÃ³n Ilegal</option>
                            <option value="otro">ğŸ“ Otro</option>
                        </select>
                    </div>
                </div>

                <div class="form-section">
                    <h3>ğŸ“‹ Detalles</h3>
                    <div class="form-group"><label>TÃ­tulo de la Denuncia</label><input type="text" id="titulo" placeholder="DescripciÃ³n breve del problema" required></div>
                    <div class="form-group"><label>DescripciÃ³n Detallada</label><textarea id="descripcion" placeholder="Proporciona todos los detalles que puedas..." rows="5" required></textarea></div>
                    <div class="form-group"><label>Nivel de Severidad</label>
                        <div class="severity-selector">
                            <input type="radio" id="sev-baja" name="severidad" value="baja"><label for="sev-baja" class="severity-label severity-baja">ğŸŸ¢ Baja</label>
                            <input type="radio" id="sev-media" name="severidad" value="media"><label for="sev-media" class="severity-label severity-media">ğŸŸ¡ Media</label>
                            <input type="radio" id="sev-alta" name="severidad" value="alta"><label for="sev-alta" class="severity-label severity-alta">ğŸ”´ Alta</label>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>ğŸ‘¤ InformaciÃ³n de Contacto</h3>
                    <div class="form-group"><label>Nombre Completo</label><input type="text" id="nombre" placeholder="Tu nombre" required></div>
                    <div class="form-group"><label>Email</label><input type="email" id="email" placeholder="tu@email.com" required></div>
                    <div class="form-group"><label>TelÃ©fono (Opcional)</label><input type="tel" id="telefono" placeholder="+593 9 9999999"></div>
                    <div class="form-group checkbox"><input type="checkbox" id="anonimo" onclick="toggleAnonimo()"><label for="anonimo">Deseo reportar de forma anÃ³nima</label></div>
                </div>

                <div class="form-section">
                    <h3>ğŸ“¸ Archivos Adjuntos</h3>
                    <div class="form-group"><label>Cargar Foto/Archivo</label><input type="file" id="adjunto" accept="image/*,.pdf" multiple><small>Formatos: JPG, PNG, PDF (mÃ¡x 10MB)</small></div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-primary">âœ“ Enviar Reporte</button>
                    <button type="button" class="btn-secondary" onclick="window.closeReporteForm()">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="toast-container"></div>

    <button id="btn-reporte-flotante" onclick="window.openReporteForm()"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M2 12h20"/></svg><span>Reportar</span></button>

    <script src='https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2'></script>
    <script src="main.js"></script>
    <script src="dashboards.js"></script>
    <script src="reportes.js"></script>
</body>
</html>
